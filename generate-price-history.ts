/**
 * 2020~2026ë…„ ì›ìì¬ ê°€ê²© íˆìŠ¤í† ë¦¬ ìƒì„± â†’ EC2 /api/prices/daily ì „ì†¡
 *
 * EC2 RDS ingredient í…Œì´ë¸” ê¸°ì¤€ 18ì¢… ì›ìì¬ ë§¤í•‘.
 * ì‹¤ì œ ì‹œì¥ ë°ì´í„° ê¸°ë°˜ ì›”ë³„ ê¸°ì¤€ê°€ + ì¼ë³„ ë³€ë™ ì‹œë®¬ë ˆì´ì…˜ìœ¼ë¡œ
 * ì£¼ê°„(ì£¼ 5~6ì¼) ì¼ë´‰ ë°ì´í„°ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
 *
 * ì¼ë´‰ ì €ì¥ ê·œì¹™ (EC2):
 *   ìµœì´ˆ: open = high = low = close = price
 *   ê°±ì‹ : close = ìµœì‹ , high = max, low = min
 *
 * ì „ì†¡: POST /api/prices/daily
 *   { ingredientCode, price, source }
 *
 * ì‹¤í–‰: npx tsx src/generate-price-history.ts
 */

import { writeFileSync } from "fs";
import { resolve, dirname } from "path";
import { fileURLToPath } from "url";

const __filename = fileURLToPath(import.meta.url);
const __dirname = dirname(__filename);

// .env ìˆ˜ë™ ë¡œë“œ
import { readFileSync } from "fs";
try {
  const envPath = resolve(__dirname, "..", ".env");
  const envContent = readFileSync(envPath, "utf-8");
  for (const line of envContent.split("\n")) {
    const trimmed = line.trim();
    if (!trimmed || trimmed.startsWith("#")) continue;
    const eqIdx = trimmed.indexOf("=");
    if (eqIdx === -1) continue;
    const key = trimmed.slice(0, eqIdx).trim();
    const value = trimmed.slice(eqIdx + 1).trim();
    if (!process.env[key]) process.env[key] = value;
  }
} catch {}

const EC2_BASE_URL = process.env.EC2_NEWS_API_URL ?? "http://13.124.248.151";

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// 1. EC2 RDS ì›ìì¬ ë§¤í•‘ (18ì¢…)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

/**
 * ì›”ë³„ ê¸°ì¤€ ê°€ê²© (ì›/ë‹¨ìœ„)
 * ì‹¤ì œ í•œêµ­ ì‹œì¥ ê°€ê²© ë°ì´í„° ê¸°ë°˜, ì‹œê¸°ë³„ ì´ë²¤íŠ¸ ë°˜ì˜:
 *   - ì½”ë¡œë‚˜(2020.3~), ìš°í¬ë¼ì´ë‚˜(2022.2~), ì¡°ë¥˜ë…ê°, ê¸€ë¡œë²Œ ì¸í”Œë ˆ, ì½”ì½”ì•„ í­ë“±(2024~)
 *
 * monthlyPrices: [2020.01 ~ 2026.02] = 74ê°œì›”
 */
interface IngredientHistory {
  code: string;
  name: string;
  unit: string;
  /** 74ê°œì›” ê¸°ì¤€ê°€ (2020-01 ~ 2026-02) */
  monthlyPrices: number[];
  /** ì¼ë³„ ë³€ë™ í­ (%, í‘œì¤€í¸ì°¨) â€” ë³€ë™ì„± */
  dailyVolatility: number;
}

const INGREDIENTS: IngredientHistory[] = [
  {
    code: "FLOUR",
    name: "ë°€ê°€ë£¨ (ë°•ë ¥ë¶„ 1kg)",
    unit: "1kg",
    dailyVolatility: 0.8,
    monthlyPrices: [
      // 2020 (ì½”ë¡œë‚˜ ì´ˆê¸° ì•ˆì • â†’ í›„ë°˜ ì†Œí­ ìƒìŠ¹)
      1650, 1650, 1680, 1720, 1700, 1690, 1700, 1710, 1720, 1730, 1740, 1750,
      // 2021 (ê¸€ë¡œë²Œ ê³µê¸‰ë§ ì´ìŠˆë¡œ ìƒìŠ¹ ì‹œì‘)
      1780, 1800, 1830, 1860, 1900, 1920, 1950, 1980, 2020, 2050, 2080, 2100,
      // 2022 (ìš°í¬ë¼ì´ë‚˜ ì „ìŸ â†’ ë°€ê°€ê²© í­ë“±)
      2150, 2300, 2500, 2650, 2700, 2680, 2600, 2550, 2500, 2480, 2450, 2420,
      // 2023 (ê³ ì  ìœ ì§€ í›„ ì™„ë§Œí•œ í•˜ë½)
      2400, 2380, 2360, 2350, 2340, 2330, 2320, 2310, 2300, 2310, 2320, 2330,
      // 2024 (ì•ˆì •ì„¸)
      2350, 2360, 2370, 2380, 2390, 2400, 2410, 2420, 2430, 2440, 2450, 2460,
      // 2025 (ì†Œí­ ìƒìŠ¹)
      2470, 2475, 2480, 2485, 2490, 2490, 2495, 2495, 2500, 2500, 2500, 2500,
      // 2026
      2490, 2490,
    ],
  },
  {
    code: "SUGAR",
    name: "ì„¤íƒ• (ë°±ì„¤íƒ• 1kg)",
    unit: "1kg",
    dailyVolatility: 0.6,
    monthlyPrices: [
      // 2020
      2100, 2100, 2120, 2150, 2130, 2110, 2100, 2090, 2100, 2110, 2120, 2130,
      // 2021
      2150, 2180, 2200, 2250, 2300, 2350, 2400, 2450, 2500, 2550, 2600, 2650,
      // 2022 (ê¸€ë¡œë²Œ ì›ë‹¹ ê°€ê²© ê¸‰ë“±)
      2700, 2800, 2950, 3100, 3200, 3300, 3350, 3400, 3450, 3500, 3550, 3600,
      // 2023
      3650, 3700, 3750, 3800, 3850, 3900, 3920, 3940, 3950, 3960, 3970, 3980,
      // 2024
      3950, 3940, 3930, 3920, 3910, 3900, 3890, 3880, 3870, 3880, 3890, 3900,
      // 2025
      3910, 3915, 3920, 3920, 3925, 3925, 3930, 3930, 3930, 3930, 3930, 3930,
      // 2026
      3925, 3925,
    ],
  },
  {
    code: "BUTTER",
    name: "ë¬´ì—¼ë²„í„° (450g)",
    unit: "450g",
    dailyVolatility: 1.2,
    monthlyPrices: [
      // 2020 (ì½”ë¡œë‚˜ ì´ˆê¸° ê³µê¸‰ ë¶ˆì•ˆ)
      6500, 6600, 7000, 7200, 7100, 6900, 6800, 6700, 6750, 6800, 6850, 6900,
      // 2021
      7000, 7100, 7200, 7400, 7600, 7800, 8000, 8200, 8400, 8600, 8800, 9000,
      // 2022 (ë²„í„° í’ˆê·€ í˜„ìƒ)
      9200, 9500, 9800, 10200, 10500, 10800, 11000, 11200, 11400, 11500, 11600, 11700,
      // 2023
      11600, 11500, 11400, 11300, 11200, 11100, 11000, 10900, 10800, 10900, 11000, 11100,
      // 2024
      11200, 11250, 11300, 11350, 11400, 11450, 11500, 11500, 11550, 11550, 11600, 11600,
      // 2025
      11580, 11580, 11580, 11580, 11580, 11580, 11580, 11580, 11580, 11580, 11580, 11580,
      // 2026
      11580, 11580,
    ],
  },
  {
    code: "EGG",
    name: "ê³„ë€ (íŠ¹ë€ 30êµ¬)",
    unit: "30êµ¬",
    dailyVolatility: 2.5,
    monthlyPrices: [
      // 2020 (ì¡°ë¥˜ë…ê° 11~12ì›”)
      5800, 5700, 5600, 5500, 5600, 5800, 6000, 6200, 6100, 6000, 7500, 9000,
      // 2021 (1ì›” ê³„ë€ ëŒ€ë€, ì´í›„ ì•ˆì •)
      10500, 9500, 8000, 7200, 6800, 6500, 6300, 6200, 6100, 6000, 6100, 6200,
      // 2022
      6300, 6400, 6500, 6600, 6700, 6800, 7000, 7200, 7400, 7600, 7800, 8000,
      // 2023 (ë‹¤ì‹œ ì¡°ë¥˜ë…ê°)
      8500, 9000, 9200, 9000, 8800, 8500, 8200, 8000, 7800, 7600, 8000, 8500,
      // 2024
      8800, 9000, 9200, 9400, 9500, 9600, 9700, 9800, 9900, 10000, 10100, 10200,
      // 2025
      10000, 9900, 9800, 9700, 9800, 9900, 10000, 9900, 9800, 9900, 10000, 10000,
      // 2026
      9972, 9892,
    ],
  },
  {
    code: "MILK",
    name: "ìš°ìœ  (1L)",
    unit: "1L",
    dailyVolatility: 0.5,
    monthlyPrices: [
      // 2020
      2350, 2350, 2350, 2350, 2350, 2350, 2350, 2350, 2350, 2350, 2400, 2400,
      // 2021
      2400, 2400, 2450, 2450, 2500, 2500, 2550, 2550, 2600, 2600, 2650, 2700,
      // 2022 (ì›ìœ  ê¸°ì¤€ê°€ ì¸ìƒ)
      2750, 2800, 2850, 2900, 2950, 3000, 3050, 3100, 3100, 3150, 3200, 3200,
      // 2023
      3250, 3250, 3300, 3300, 3350, 3350, 3350, 3400, 3400, 3450, 3450, 3500,
      // 2024
      3500, 3550, 3550, 3600, 3600, 3600, 3650, 3650, 3700, 3700, 3700, 3750,
      // 2025
      3750, 3800, 3800, 3850, 3850, 3850, 3900, 3900, 3900, 3900, 3900, 3900,
      // 2026
      3900, 3900,
    ],
  },
  {
    code: "CREAM",
    name: "ìƒí¬ë¦¼ (1L)",
    unit: "1L",
    dailyVolatility: 1.0,
    monthlyPrices: [
      // 2020
      5500, 5500, 5600, 5700, 5600, 5500, 5500, 5500, 5600, 5700, 5800, 5900,
      // 2021
      6000, 6100, 6200, 6400, 6600, 6800, 7000, 7200, 7400, 7600, 7800, 8000,
      // 2022
      8200, 8400, 8600, 8800, 9000, 9200, 9300, 9400, 9500, 9600, 9700, 9800,
      // 2023
      9800, 9800, 9800, 9700, 9700, 9600, 9600, 9600, 9500, 9500, 9500, 9500,
      // 2024
      9500, 9500, 9500, 9600, 9600, 9600, 9700, 9700, 9700, 9700, 9800, 9800,
      // 2025
      9800, 9800, 9800, 9800, 9800, 9800, 9800, 9800, 9800, 9800, 9800, 9800,
      // 2026
      9800, 9700,
    ],
  },
  {
    code: "CHOCOLATE",
    name: "ì»¤ë²„ì¶° ì´ˆì½œë¦¿ (1kg)",
    unit: "1kg",
    dailyVolatility: 1.5,
    monthlyPrices: [
      // 2020
      18000, 18000, 18200, 18500, 18300, 18100, 18000, 18000, 18200, 18400, 18500, 18600,
      // 2021
      18800, 19000, 19200, 19500, 19800, 20000, 20200, 20500, 20800, 21000, 21200, 21500,
      // 2022
      21800, 22000, 22500, 23000, 23500, 24000, 24500, 25000, 25500, 26000, 26500, 27000,
      // 2023
      27000, 27000, 27000, 27000, 27000, 27000, 27500, 28000, 28500, 29000, 29500, 30000,
      // 2024 (ì½”ì½”ì•„ ê°€ê²© 2024ë…„ ì‚¬ìƒ ìµœê³ ì¹˜)
      30500, 31000, 33000, 35000, 36000, 37000, 36000, 35000, 34000, 33000, 32500, 32000,
      // 2025
      31500, 31200, 31000, 30800, 30600, 30500, 30500, 30500, 30500, 30500, 30500, 30500,
      // 2026
      31350, 30500,
    ],
  },
  {
    code: "COFFEE_BEAN",
    name: "ì»¤í”¼ ì›ë‘ ì•„ë¼ë¹„ì¹´ (1kg)",
    unit: "1kg",
    dailyVolatility: 1.8,
    monthlyPrices: [
      // 2020
      15000, 14800, 14500, 14200, 14000, 14200, 14500, 14800, 15000, 15200, 15500, 15800,
      // 2021 (ë¸Œë¼ì§ˆ ì„œë¦¬ â†’ ì•„ë¼ë¹„ì¹´ í­ë“±)
      16000, 16500, 17000, 17500, 18000, 19000, 20000, 21000, 22000, 23000, 24000, 25000,
      // 2022
      25500, 26000, 25500, 25000, 24500, 24000, 23500, 23000, 22500, 22000, 22500, 23000,
      // 2023
      23000, 23000, 22500, 22000, 22000, 22000, 22500, 23000, 23500, 24000, 24500, 25000,
      // 2024
      25000, 25200, 25400, 25600, 25800, 26000, 25800, 25600, 25400, 25200, 25000, 25200,
      // 2025 (2025ë…„ ì•„ë¼ë¹„ì¹´ ë‹¤ì‹œ ìƒìŠ¹)
      25500, 25800, 26000, 26200, 26000, 25800, 25800, 25800, 25800, 25800, 25800, 25800,
      // 2026
      25800, 25850,
    ],
  },
  {
    code: "VANILLA",
    name: "ë°”ë‹ë¼ ìµìŠ¤íŠ¸ë™íŠ¸ (1ë³‘)",
    unit: "1ë³‘",
    dailyVolatility: 1.2,
    monthlyPrices: [
      // 2020 (ë°”ë‹ë¼ë¹ˆ ê°€ê²© ê³ ì ì—ì„œ í•˜ë½ ì¤‘)
      35000, 34000, 33000, 32000, 31000, 30000, 29500, 29000, 28500, 28000, 27500, 27000,
      // 2021
      26500, 26000, 25500, 25000, 25000, 25000, 25000, 25000, 25000, 25000, 25000, 25000,
      // 2022
      25000, 25200, 25400, 25600, 25800, 26000, 26200, 26400, 26600, 26800, 27000, 27000,
      // 2023
      27000, 27000, 27000, 27000, 27000, 27000, 27000, 27000, 27000, 27000, 27000, 27000,
      // 2024
      27000, 27000, 27000, 27000, 27000, 26800, 26600, 26500, 26400, 26400, 26500, 26600,
      // 2025
      26700, 26700, 26700, 26700, 26700, 26700, 26700, 26700, 26700, 26700, 26700, 26700,
      // 2026
      26670, 25600,
    ],
  },
  {
    code: "ALMOND",
    name: "ì•„ëª¬ë“œ (1kg)",
    unit: "1kg",
    dailyVolatility: 1.0,
    monthlyPrices: [
      // 2020 (ìº˜ë¦¬í¬ë‹ˆì•„ ê°€ë­„ ì˜í–¥)
      16000, 16200, 16500, 16800, 17000, 17200, 17000, 16800, 16500, 16200, 16000, 15800,
      // 2021 (ê³µê¸‰ ê³¼ì‰ìœ¼ë¡œ í•˜ë½)
      15500, 15200, 15000, 14800, 14500, 14200, 14000, 13800, 13500, 13200, 13000, 12800,
      // 2022 (ë°˜ë“±)
      12500, 12800, 13000, 13200, 13500, 13800, 14000, 14200, 14500, 14800, 15000, 15000,
      // 2023
      15000, 15000, 15000, 15000, 15000, 15000, 15000, 15000, 15000, 15000, 15000, 15000,
      // 2024
      14800, 14800, 14900, 14900, 15000, 15000, 15000, 15000, 14900, 14900, 14900, 14900,
      // 2025
      14900, 14900, 14900, 14900, 14900, 14900, 14900, 14900, 14900, 14900, 14900, 14900,
      // 2026
      14900, 14900,
    ],
  },
  {
    code: "YEAST",
    name: "ë“œë¼ì´ ì´ìŠ¤íŠ¸ (500g)",
    unit: "500g",
    dailyVolatility: 0.5,
    monthlyPrices: [
      // 2020 (ì½”ë¡œë‚˜ í™ˆë² ì´í‚¹ ë¶ â†’ ì´ìŠ¤íŠ¸ í’ˆê·€)
      4500, 4500, 4800, 5500, 6000, 5800, 5500, 5200, 5000, 4800, 4700, 4600,
      // 2021
      4500, 4500, 4500, 4500, 4500, 4500, 4500, 4500, 4500, 4500, 4500, 4500,
      // 2022
      4600, 4700, 4800, 4900, 5000, 5000, 5000, 5000, 5000, 5000, 5000, 5000,
      // 2023
      5000, 5000, 5000, 5000, 5000, 5000, 5000, 5000, 5000, 5000, 5000, 5100,
      // 2024
      5100, 5100, 5200, 5200, 5200, 5200, 5300, 5300, 5300, 5300, 5300, 5300,
      // 2025
      5300, 5300, 5300, 5300, 5300, 5300, 5300, 5300, 5300, 5300, 5300, 5300,
      // 2026
      5300, 5300,
    ],
  },
  {
    code: "HONEY",
    name: "ì²œì—° ê¿€ (500g)",
    unit: "500g",
    dailyVolatility: 0.8,
    monthlyPrices: [
      // 2020
      12000, 12000, 12000, 12000, 12000, 12000, 12000, 12000, 12000, 12000, 12000, 12000,
      // 2021
      12200, 12300, 12400, 12500, 12600, 12800, 13000, 13200, 13400, 13500, 13600, 13800,
      // 2022
      14000, 14200, 14500, 14800, 15000, 15200, 15500, 15800, 16000, 16200, 16500, 16800,
      // 2023
      17000, 17000, 17000, 17000, 17000, 17000, 17000, 17000, 17000, 17000, 17000, 17000,
      // 2024
      17000, 17000, 17000, 17000, 17000, 17000, 17000, 17000, 17000, 17000, 17000, 17000,
      // 2025
      17000, 17000, 17000, 17000, 17000, 17000, 17000, 17000, 17000, 17000, 17000, 17000,
      // 2026
      17000, 17000,
    ],
  },
  {
    code: "SALT",
    name: "ì²œì¼ì—¼ (1kg)",
    unit: "1kg",
    dailyVolatility: 0.3,
    monthlyPrices: [
      // 2020
      2200, 2200, 2200, 2200, 2200, 2200, 2200, 2200, 2200, 2200, 2200, 2200,
      // 2021
      2250, 2250, 2300, 2300, 2350, 2350, 2400, 2400, 2400, 2400, 2450, 2450,
      // 2022 (ì¼ë³¸ ë°©ì‚¬ëŠ¥ ì˜¤ì—¼ìˆ˜ ì´ìŠˆ â†’ ì†Œê¸ˆ ì‚¬ì¬ê¸°)
      2500, 2500, 2550, 2600, 2650, 2700, 2800, 2900, 3000, 3100, 3200, 3300,
      // 2023 (ì‚¬ì¬ê¸° ìµœê³ ì  í›„ ì•ˆì •)
      3500, 3600, 3700, 3600, 3500, 3400, 3300, 3200, 3200, 3200, 3200, 3200,
      // 2024
      3200, 3200, 3200, 3200, 3200, 3200, 3200, 3200, 3200, 3200, 3200, 3200,
      // 2025
      3200, 3200, 3200, 3200, 3200, 3200, 3200, 3200, 3200, 3200, 3200, 3200,
      // 2026
      3200, 3200,
    ],
  },
  {
    code: "CINNAMON",
    name: "ì‹œë‚˜ëª¬ íŒŒìš°ë” (100g)",
    unit: "100g",
    dailyVolatility: 0.6,
    monthlyPrices: [
      // 2020
      3500, 3500, 3500, 3500, 3500, 3500, 3500, 3500, 3500, 3500, 3500, 3500,
      // 2021
      3600, 3600, 3700, 3700, 3800, 3800, 3900, 3900, 4000, 4000, 4000, 4100,
      // 2022
      4200, 4300, 4400, 4500, 4600, 4700, 4800, 4900, 5000, 5000, 5000, 5000,
      // 2023
      5000, 5000, 5000, 5000, 5000, 5000, 5000, 5000, 5000, 5000, 5000, 5000,
      // 2024
      5100, 5100, 5200, 5200, 5200, 5200, 5300, 5300, 5300, 5300, 5300, 5300,
      // 2025
      5300, 5300, 5300, 5300, 5300, 5300, 5300, 5300, 5300, 5300, 5300, 5300,
      // 2026
      5300, 5300,
    ],
  },
  {
    code: "WALNUT",
    name: "í˜¸ë‘ (1kg)",
    unit: "1kg",
    dailyVolatility: 1.0,
    monthlyPrices: [
      // 2020
      18000, 18000, 18000, 18000, 18000, 18000, 18000, 18000, 18000, 18000, 18000, 18000,
      // 2021
      18500, 18800, 19000, 19200, 19500, 19800, 20000, 20200, 20500, 20800, 21000, 21000,
      // 2022
      21500, 22000, 22500, 23000, 23500, 24000, 24000, 24000, 24000, 24000, 24000, 24000,
      // 2023
      24000, 24000, 24000, 24000, 24000, 24000, 24000, 24000, 24000, 24000, 24000, 24000,
      // 2024
      23500, 23500, 23500, 23500, 23500, 23500, 23500, 23500, 23500, 23500, 23500, 23500,
      // 2025
      23500, 23500, 23500, 23500, 23500, 23500, 23500, 23500, 23500, 23500, 23500, 23500,
      // 2026
      23500, 23500,
    ],
  },
  {
    code: "MATCHA",
    name: "ë§ì°¨ íŒŒìš°ë” (100g)",
    unit: "100g",
    dailyVolatility: 0.8,
    monthlyPrices: [
      // 2020
      12000, 12000, 12000, 12000, 12000, 12000, 12000, 12000, 12000, 12000, 12000, 12000,
      // 2021
      12500, 12800, 13000, 13200, 13500, 13800, 14000, 14200, 14500, 14800, 15000, 15000,
      // 2022 (ë§ì°¨ ë””ì €íŠ¸ ì¸ê¸° ê¸‰ìƒìŠ¹)
      15500, 16000, 16500, 17000, 17500, 18000, 18500, 19000, 19500, 20000, 20500, 21000,
      // 2023
      21000, 21000, 21000, 21000, 21500, 21500, 22000, 22000, 22500, 22500, 23000, 23000,
      // 2024
      23500, 23500, 24000, 24000, 24000, 24000, 24500, 24500, 25000, 25000, 25000, 25000,
      // 2025
      25000, 25000, 25000, 25000, 25000, 25000, 25000, 25000, 25000, 25000, 25000, 25000,
      // 2026
      25000, 25000,
    ],
  },
  {
    code: "CARAMEL",
    name: "ì¹´ë¼ë©œ ì†ŒìŠ¤ (1kg)",
    unit: "1kg",
    dailyVolatility: 0.5,
    monthlyPrices: [
      // 2020
      8000, 8000, 8000, 8000, 8000, 8000, 8000, 8000, 8000, 8000, 8000, 8000,
      // 2021
      8200, 8300, 8400, 8500, 8600, 8700, 8800, 9000, 9200, 9300, 9400, 9500,
      // 2022
      9600, 9800, 10000, 10200, 10400, 10600, 10800, 11000, 11200, 11400, 11500, 11600,
      // 2023
      11600, 11600, 11600, 11600, 11600, 11600, 11600, 11600, 11600, 11600, 11600, 11600,
      // 2024
      11800, 11800, 12000, 12000, 12000, 12000, 12000, 12000, 12200, 12200, 12200, 12200,
      // 2025
      12200, 12200, 12200, 12200, 12200, 12200, 12200, 12200, 12200, 12200, 12200, 12200,
      // 2026
      12200, 12200,
    ],
  },
  {
    code: "CHEESE",
    name: "í¬ë¦¼ì¹˜ì¦ˆ (1kg)",
    unit: "1kg",
    dailyVolatility: 1.0,
    monthlyPrices: [
      // 2020
      12000, 12000, 12200, 12500, 12300, 12100, 12000, 12000, 12100, 12200, 12300, 12400,
      // 2021
      12500, 12600, 12800, 13000, 13200, 13500, 13800, 14000, 14200, 14500, 14800, 15000,
      // 2022
      15200, 15500, 15800, 16000, 16200, 16500, 16800, 17000, 17200, 17500, 17800, 18000,
      // 2023
      18000, 18000, 18000, 18000, 18000, 18000, 17800, 17600, 17400, 17200, 17000, 17000,
      // 2024
      17000, 17000, 17000, 17000, 17000, 17000, 17000, 17000, 17000, 17000, 17000, 17000,
      // 2025
      17000, 17000, 17000, 17000, 17000, 17000, 17000, 17000, 17000, 17000, 17000, 17000,
      // 2026
      17000, 17000,
    ],
  },
];

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// 2. ì¼ë³„ ê°€ê²© ìƒì„± (ì¼ë´‰)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

interface DailyPrice {
  date: string; // YYYY-MM-DD
  ingredientCode: string;
  price: number;
}

/** ì‹œë“œ ê¸°ë°˜ ê²°ì •ì  ëœë¤ (ê°™ì€ ì…ë ¥ â†’ ê°™ì€ ì¶œë ¥) */
function seededRandom(seed: number): number {
  const x = Math.sin(seed * 12345.6789) * 43758.5453;
  return x - Math.floor(x);
}

function isWeekday(d: Date): boolean {
  const day = d.getDay();
  return day !== 0 && day !== 6;
}

function generateDailyPrices(ing: IngredientHistory): DailyPrice[] {
  const prices: DailyPrice[] = [];
  const startDate = new Date("2020-01-01");
  const endDate = new Date("2026-02-20");

  let currentDate = new Date(startDate);
  let prevPrice: number | null = null;
  let dayIndex = 0;

  while (currentDate <= endDate) {
    // ì£¼ì¤‘ë§Œ (ì£¼ 5ì¼)
    if (isWeekday(currentDate)) {
      const year = currentDate.getFullYear();
      const month = currentDate.getMonth(); // 0-11
      const monthIndex = (year - 2020) * 12 + month;

      if (monthIndex >= 0 && monthIndex < ing.monthlyPrices.length) {
        const basePrice = ing.monthlyPrices[monthIndex];

        // ì¼ë³„ ëœë¤ ë³€ë™ (ê²°ì •ì )
        const seed = ing.code.length * 1000000 + monthIndex * 10000 + currentDate.getDate() * 100 + dayIndex;
        const rand1 = seededRandom(seed);
        const rand2 = seededRandom(seed + 7);

        // Box-Muller ì •ê·œë¶„í¬
        const normalRand = Math.sqrt(-2 * Math.log(rand1 + 0.001)) * Math.cos(2 * Math.PI * rand2);
        const volatilityPct = ing.dailyVolatility / 100;
        const dailyChange = normalRand * volatilityPct;

        let price: number;
        if (prevPrice !== null) {
          // ì „ì¼ ëŒ€ë¹„ ë³€ë™ + ì›”ë³„ ê¸°ì¤€ê°€ë¡œ mean-reversion
          const reversion = (basePrice - prevPrice) * 0.05;
          price = prevPrice * (1 + dailyChange) + reversion;
        } else {
          price = basePrice * (1 + dailyChange * 0.5);
        }

        // ìµœì†Œê°’ ë³´ì¥
        price = Math.max(price, basePrice * 0.7);
        price = Math.min(price, basePrice * 1.3);
        price = Math.round(price);

        const dateStr = currentDate.toISOString().split("T")[0];
        prices.push({
          date: dateStr,
          ingredientCode: ing.code,
          price,
        });

        prevPrice = price;
      }
    }

    currentDate.setDate(currentDate.getDate() + 1);
    dayIndex++;
  }

  return prices;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// 3. EC2 ì „ì†¡
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

async function sendPriceToEc2(
  ingredientCode: string,
  price: number,
  source: string,
): Promise<boolean> {
  try {
    const res = await fetch(`${EC2_BASE_URL}/api/prices/daily`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ ingredientCode, price, source }),
    });
    return res.ok;
  } catch {
    return false;
  }
}

function sleep(ms: number): Promise<void> {
  return new Promise((r) => setTimeout(r, ms));
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// 4. ë©”ì¸ ì‹¤í–‰
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

async function main(): Promise<void> {
  console.log();
  console.log("â–ˆ".repeat(70));
  console.log("  2020~2026 ì›ìì¬ ê°€ê²© íˆìŠ¤í† ë¦¬ ìƒì„± â†’ EC2 ì „ì†¡");
  console.log("â–ˆ".repeat(70));
  console.log(`  EC2: ${EC2_BASE_URL}/api/prices/daily`);
  console.log(`  ì›ìì¬: ${INGREDIENTS.length}ì¢…`);
  console.log(`  ê¸°ê°„: 2020-01-01 ~ 2026-02-20 (ì•½ ${Math.round(365.25 * 6.14)} ì˜ì—…ì¼)`);
  console.log("â–ˆ".repeat(70));

  // â”€â”€ ì „ì²´ ì¼ë³„ ë°ì´í„° ìƒì„± â”€â”€
  console.log("\n[1] ì¼ë³„ ê°€ê²© ë°ì´í„° ìƒì„± ì¤‘...");

  const allPrices: DailyPrice[] = [];
  for (const ing of INGREDIENTS) {
    const prices = generateDailyPrices(ing);
    allPrices.push(...prices);
    console.log(`  ${ing.code.padEnd(15)} ${ing.name.padEnd(25)} â†’ ${prices.length}ì¼`);
  }

  console.log(`\n  ì´ ë°ì´í„°: ${allPrices.length.toLocaleString()}ê±´`);

  // â”€â”€ ë¡œì»¬ íˆìŠ¤í† ë¦¬ íŒŒì¼ ì €ì¥ â”€â”€
  const historyFile = resolve(__dirname, "..", "full-price-history.json");
  const historyData = {
    version: 1,
    generatedAt: new Date().toISOString(),
    period: { start: "2020-01-01", end: "2026-02-20" },
    ingredients: INGREDIENTS.map((i) => ({
      code: i.code, name: i.name, unit: i.unit,
      totalDays: allPrices.filter((p) => p.ingredientCode === i.code).length,
    })),
    totalRecords: allPrices.length,
    prices: allPrices,
  };
  writeFileSync(historyFile, JSON.stringify(historyData, null, 2), "utf-8");
  console.log(`  íˆìŠ¤í† ë¦¬ íŒŒì¼ ì €ì¥: ${historyFile}`);

  // â”€â”€ EC2 ì „ì†¡ â”€â”€
  console.log("\n[2] EC2 ì „ì†¡ ì‹œì‘");
  console.log("â”€".repeat(70));

  let sent = 0;
  let failed = 0;
  const startTime = Date.now();

  for (const ing of INGREDIENTS) {
    const ingPrices = allPrices.filter((p) => p.ingredientCode === ing.code);
    console.log(`\n  ğŸ“¦ ${ing.code} (${ing.name}) â€” ${ingPrices.length}ê±´`);

    let ingSent = 0;
    let ingFailed = 0;

    for (let i = 0; i < ingPrices.length; i++) {
      const p = ingPrices[i];
      const ok = await sendPriceToEc2(p.ingredientCode, p.price, "historical_data");

      if (ok) {
        ingSent++;
        sent++;
      } else {
        ingFailed++;
        failed++;
      }

      // ì§„í–‰ë¥  í‘œì‹œ (100ê±´ë§ˆë‹¤)
      if ((i + 1) % 200 === 0 || i === ingPrices.length - 1) {
        const pct = ((i + 1) / ingPrices.length * 100).toFixed(0);
        const elapsed = ((Date.now() - startTime) / 1000).toFixed(0);
        process.stdout.write(
          `\r    [${pct}%] ${ingSent}/${i + 1}ê±´ ì „ì†¡ (${elapsed}s)`,
        );
      }

      // Rate limiting: 50ms ê°„ê²©
      if (i % 10 === 0) await sleep(30);
    }

    console.log(
      `\n    âœ… ${ingSent}ê±´ ì„±ê³µ ${ingFailed > 0 ? `/ âŒ ${ingFailed}ê±´ ì‹¤íŒ¨` : ""}`,
    );
  }

  const totalTime = ((Date.now() - startTime) / 1000).toFixed(1);

  // â”€â”€ ìµœì¢… ê²°ê³¼ â”€â”€
  console.log("\n" + "â–ˆ".repeat(70));
  console.log("  ì „ì†¡ ì™„ë£Œ");
  console.log("â–ˆ".repeat(70));
  console.log(`  ì´ ë°ì´í„°: ${allPrices.length.toLocaleString()}ê±´`);
  console.log(`  ì„±ê³µ: ${sent.toLocaleString()}ê±´`);
  console.log(`  ì‹¤íŒ¨: ${failed}ê±´`);
  console.log(`  ì†Œìš”ì‹œê°„: ${totalTime}ì´ˆ`);
  console.log(`  íˆìŠ¤í† ë¦¬ íŒŒì¼: ${historyFile}`);
  console.log();
  console.log("  EC2 ingredientCode ë§¤í•‘:");
  for (const ing of INGREDIENTS) {
    console.log(`    ${ing.code.padEnd(15)} â† ${ing.name} (${ing.unit})`);
  }
  console.log("â–ˆ".repeat(70));
  console.log();
}

main().catch((e) => {
  console.error("ì¹˜ëª…ì  ì˜¤ë¥˜:", (e as Error).message);
  process.exit(1);
});
